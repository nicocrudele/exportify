(this.webpackJsonpexportify=this.webpackJsonpexportify||[]).push([[0],{55:function(t,e,s){},56:function(t,e,s){},98:function(t,e,s){"use strict";s.r(e);var n=s(0),a=s(2),i=s.n(a),r=s(24),c=s.n(r),o=s(40),l=s.n(o),p=s(41),u=s.n(p),d=(s(55),s(56),s(13)),h=s(42),j=s(14),b=s(25);d.b.add(h.a,j.a,j.d,j.b,j.c,b.a,b.b);var f=s(4),x=s(6),m=s(7),y=s(9),O=s(8),v=s(100),k=s(3),g=s.n(k);function w(){var t=C("app_client_id");""===t&&(t="9950ac751e34487dbbe027c4fd7f8e99"),window.location.href="https://accounts.spotify.com/authorize?client_id="+t+"&redirect_uri="+encodeURIComponent([window.location.protocol,"//",window.location.host,window.location.pathname].join(""))+"&scope=playlist-read-private%20playlist-read-collaborative%20user-library-read&response_type=token"}function C(t){t=t.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}function _(t,e){return g.a.ajax({url:t,headers:{Authorization:"Bearer "+e}}).fail((function(t,e){401===t.status?window.location.href=window.location.href.split("#")[0]:429===t.status?window.location.href=window.location.href.split("#")[0]+"?rate_limit_message=true":alert(t.responseText)}))}var L=function(t){Object(y.a)(s,t);var e=Object(O.a)(s);function s(){return Object(x.a)(this,s),e.apply(this,arguments)}return Object(m.a)(s,[{key:"render",value:function(){return Object(n.jsxs)(v.a,{id:"loginButton",type:"submit",bsSize:"large",onClick:w,children:[Object(n.jsx)(f.a,{icon:["far","check-circle"],size:"sm"})," Get Started"]})}}]),s}(i.a.Component),R=s(19),N={export:function(t,e){var s=this;this.csvData(t,e).then((function(t){var n=new Blob([t],{type:"text/csv;charset=utf-8"});Object(R.saveAs)(n,s.fileName(e),!0)}))},csvData:function(t,e){for(var s=[],n=e.tracks.limit||100,a=0;a<e.tracks.total;a+=n)s.push(_("".concat(e.tracks.href.split("?")[0],"?offset=").concat(a,"&limit=").concat(n),t));return g.a.when.apply(g.a,s).then((function(){var t=[];"undefined"!=typeof arguments[0]&&(t="undefined"==typeof arguments[0].href?Array.prototype.slice.call(arguments).map((function(t){return t[0]})):[arguments[0]]);var e=t.map((function(t){return t.items.map((function(t){return[t.track.uri,t.track.name,t.track.artists.map((function(t){return t.uri})).join(", "),t.track.artists.map((function(t){return String(t.name).replace(/,/g,"\\,")})).join(", "),t.track.album.uri,t.track.album.name,t.track.disc_number,t.track.track_number,t.track.duration_ms,null==t.added_by?"":t.added_by.uri,t.added_at]}))}));(e=g.a.map(e,(function(t){return t}))).unshift(["Track URI","Track Name","Artist URI","Artist Name","Album URI","Album Name","Disc Number","Track Number","Track Duration (ms)","Added By","Added At"]);var s="";return e.forEach((function(t,e){var n=t.map((function(t){return'"'+String(t).replace(/"/g,'""')+'"'})).join(",");s+=n+"\n"})),s}))},fileName:function(t){return t.name.replace(/[\x00-\x1F\x7F/\\<>:;"|=,.?*[\] ]+/g,"_").toLowerCase()+".csv"}},U=function(t){Object(y.a)(s,t);var e=Object(O.a)(s);function s(){var t;Object(x.a)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).exportPlaylist=function(){N.export(t.props.access_token,t.props.playlist)},t}return Object(m.a)(s,[{key:"renderTickCross",value:function(t){return t?Object(n.jsx)(f.a,{icon:["far","check-circle"],size:"sm"}):Object(n.jsx)(f.a,{icon:["far","times-circle"],size:"sm",style:{color:"#ECEBE8"}})}},{key:"renderIcon",value:function(t){return"Liked"===t.name?Object(n.jsx)(f.a,{icon:["far","heart"],style:{color:"red"}}):Object(n.jsx)(f.a,{icon:["fas","music"]})}},{key:"render",value:function(){var t=this.props.playlist;return null==t.uri?Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{children:this.renderIcon(t)}),Object(n.jsx)("td",{children:t.name}),Object(n.jsx)("td",{colSpan:"2",children:"This playlist is not supported"}),Object(n.jsx)("td",{children:this.renderTickCross(t.public)}),Object(n.jsx)("td",{children:this.renderTickCross(t.collaborative)}),Object(n.jsx)("td",{children:"\xa0"})]},t.name):Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{children:this.renderIcon(t)}),Object(n.jsx)("td",{children:Object(n.jsx)("a",{href:t.uri,children:t.name})}),Object(n.jsx)("td",{children:Object(n.jsx)("a",{href:t.owner.uri,children:t.owner.display_name})}),Object(n.jsx)("td",{children:t.tracks.total}),Object(n.jsx)("td",{children:this.renderTickCross(t.public)}),Object(n.jsx)("td",{children:this.renderTickCross(t.collaborative)}),Object(n.jsx)("td",{className:"text-right",children:Object(n.jsxs)("button",{className:"btn btn-default btn-xs btn-success",type:"submit",onClick:this.exportPlaylist,children:[Object(n.jsx)("span",{className:"glyphicon glyphicon-save"})," Export"]})})]},t.uri)}}]),s}(i.a.Component),S=function(t){Object(y.a)(s,t);var e=Object(O.a)(s);function s(){var t;Object(x.a)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).nextClick=function(e){e.preventDefault(),null!=t.props.nextURL&&t.props.loadPlaylists(t.props.nextURL)},t.prevClick=function(e){e.preventDefault(),null!=t.props.prevURL&&t.props.loadPlaylists(t.props.prevURL)},t}return Object(m.a)(s,[{key:"render",value:function(){return null!=this.props.nextURL||null!=this.props.prevURL?Object(n.jsx)("nav",{className:"paginator text-right",children:Object(n.jsxs)("ul",{className:"pagination pagination-sm",children:[Object(n.jsx)("li",{className:null==this.props.prevURL?"disabled":"",children:Object(n.jsx)("a",{href:"#","aria-label":"Previous",onClick:this.prevClick,children:Object(n.jsx)("span",{"aria-hidden":"true",children:"\xab"})})}),Object(n.jsx)("li",{className:null==this.props.nextURL?"disabled":"",children:Object(n.jsx)("a",{href:"#","aria-label":"Next",onClick:this.nextClick,children:Object(n.jsx)("span",{"aria-hidden":"true",children:"\xbb"})})})]})}):Object(n.jsx)("div",{children:"\xa0"})}}]),s}(i.a.Component),A=s(48),P=s.n(A),T={export:function(t,e,s,n){var a=[];_("https://api.spotify.com/v1/me",t).then((function(i){for(var r=i.id,c=[],o=0;o<e;o+=20){var l="https://api.spotify.com/v1/users/"+r+"/playlists";c.push(_("".concat(l,"?offset=").concat(o,"&limit=").concat(20),t))}g.a.when.apply(g.a,c).then((function(){var e=[],i=[];return"undefined"==typeof arguments[0].href?g()(arguments).each((function(t,s){"undefined"===typeof s[0].items?e.push(s[0]):g.a.merge(e,s[0].items)})):e=arguments[0].items,e.unshift({id:"liked",name:"Liked",tracks:{href:"https://api.spotify.com/v1/me/tracks",limit:s,total:n}}),g()(e).each((function(e,s){a.push(N.fileName(s)),i.push(N.csvData(t,s))})),g.a.when.apply(g.a,i)})).then((function(){var t=new P.a;g()(arguments).each((function(e,s){t.file(a[e],s)})),t.generateAsync({type:"blob"}).then((function(t){Object(R.saveAs)(t,"spotify_playlists.zip")}))}))}))}},E=function(t){Object(y.a)(s,t);var e=Object(O.a)(s);function s(){var t;Object(x.a)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).state={playlists:[],playlistCount:0,likedSongsLimit:0,likedSongsCount:0,nextURL:null,prevURL:null},t.loadPlaylists=function(e){var s="",n="undefined"===typeof e||e.indexOf("offset=0")>-1;_("https://api.spotify.com/v1/me",t.props.access_token).then((function(a){return s=a.id,n?g.a.when.apply(g.a,[_("https://api.spotify.com/v1/users/"+s+"/tracks",t.props.access_token),_("https://api.spotify.com/v1/users/"+s+"/playlists",t.props.access_token)]):_(e,t.props.access_token)})).done((function(){for(var e,a=[],i=arguments.length,r=new Array(i),c=0;c<i;c++)r[c]=arguments[c];"success"===r[1]?(e=r[0],a=r[0].items):(e=r[1][0],a=r[1][0].items),n&&(a.unshift({id:"liked",name:"Liked",public:!1,collaborative:!1,owner:{id:s,display_name:s,uri:"spotify:user:"+s},tracks:{href:"https://api.spotify.com/v1/me/tracks",limit:r[0][0].limit,total:r[0][0].total},uri:"spotify:user:"+s+":saved"}),t.setState({likedSongsLimit:r[0][0].limit,likedSongsCount:r[0][0].total})),t.setState({playlists:a,playlistCount:e.total,nextURL:e.next,prevURL:e.previous}),g()("#playlists").fadeIn(),g()("#subtitle").text(e.offset+1+"-"+(e.offset+e.items.length)+" of "+e.total+" playlists for "+s)}))},t.exportPlaylists=function(){T.export(t.props.access_token,t.state.playlistCount,t.state.likedSongsLimit,t.state.likedSongsCount)},t}return Object(m.a)(s,[{key:"componentDidMount",value:function(){this.loadPlaylists(this.props.url)}},{key:"render",value:function(){var t=this;return this.state.playlists.length>0?Object(n.jsxs)("div",{id:"playlists",children:[Object(n.jsx)(S,{nextURL:this.state.nextURL,prevURL:this.state.prevURL,loadPlaylists:this.loadPlaylists}),Object(n.jsxs)("table",{className:"table table-hover",children:[Object(n.jsx)("thead",{children:Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{style:{width:"30px"}}),Object(n.jsx)("th",{children:"Name"}),Object(n.jsx)("th",{style:{width:"150px"},children:"Owner"}),Object(n.jsx)("th",{style:{width:"100px"},children:"Tracks"}),Object(n.jsx)("th",{style:{width:"120px"},children:"Public?"}),Object(n.jsx)("th",{style:{width:"120px"},children:"Collaborative?"}),Object(n.jsx)("th",{style:{width:"100px"},className:"text-right",children:Object(n.jsxs)("button",{className:"btn btn-default btn-xs",type:"submit",onClick:this.exportPlaylists,children:[Object(n.jsx)("span",{className:"fa fa-file-archive"}),Object(n.jsx)(f.a,{icon:["far","file-archive"]})," Export All"]})})]})}),Object(n.jsx)("tbody",{children:this.state.playlists.map((function(e,s){return Object(n.jsx)(U,{playlist:e,access_token:t.props.access_token},e.id)}))})]}),Object(n.jsx)(S,{nextURL:this.state.nextURL,prevURL:this.state.prevURL,loadPlaylists:this.loadPlaylists})]}):Object(n.jsx)("div",{className:"spinner","data-testid":"playlistTableSpinner"})}}]),s}(i.a.Component);var I=function(){var t,e=new URLSearchParams(window.location.hash.substring(1));return t=""!==C("rate_limit_message")?Object(n.jsxs)("div",{id:"rateLimitMessage",className:"lead",children:[Object(n.jsx)("p",{children:Object(n.jsx)(f.a,{icon:["fas","bolt"],style:{fontSize:"50px",marginBottom:"20px"}})}),Object(n.jsxs)("p",{children:["Oops, Exportify has encountered a ",Object(n.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://developer.spotify.com/web-api/user-guide/#rate-limiting",children:"rate limiting"})," error while using the Spotify API. This might be because of the number of users currently exporting playlists, or perhaps because you have too many playlists to export all at once. Try ",Object(n.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://github.com/watsonbox/exportify/issues/6#issuecomment-110793132",children:"creating your own"})," Spotify application. If that doesn't work, please add a comment to ",Object(n.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://github.com/watsonbox/exportify/issues/6",children:"this issue"})," where possible resolutions are being discussed."]}),Object(n.jsx)("p",{style:{marginTop:"50px"},children:"It should still be possible to export individual playlists, particularly when using your own Spotify application."})]}):e.has("access_token")?Object(n.jsx)(E,{access_token:e.get("access_token")}):Object(n.jsx)(L,{}),Object(n.jsxs)("div",{className:"App container",children:[Object(n.jsxs)("header",{className:"App-header",children:[Object(n.jsxs)("h1",{children:[Object(n.jsx)(f.a,{icon:["fab","spotify"],color:"#84BD00",size:"sm"})," ",Object(n.jsx)("a",{href:"/exportify",children:"Exportify"})]}),Object(n.jsx)("p",{id:"subtitle",className:"lead",children:"Export your Spotify playlists."})]}),t]})},D=function(t){t&&t instanceof Function&&s.e(3).then(s.bind(null,101)).then((function(e){var s=e.getCLS,n=e.getFID,a=e.getFCP,i=e.getLCP,r=e.getTTFB;s(t),n(t),a(t),i(t),r(t)}))};c.a.start({apiKey:"a65916528275f084a1754a59797a36b3",plugins:[new l.a],enabledReleaseStages:["production","staging"],onError:function(t){t.request.url="[REDACTED]"}});var B=c.a.getPlugin("react").createErrorBoundary(i.a);u.a.render(Object(n.jsx)(i.a.StrictMode,{children:Object(n.jsx)(B,{children:Object(n.jsx)(I,{})})}),document.getElementById("root")),D()}},[[98,1,2]]]);
//# sourceMappingURL=main.71f1e960.chunk.js.map